{% load static %}

<!-- Post Box (Click to Open Modal) -->
<div class="bg-gray-800 p-4 rounded-lg flex items-center space-x-4 cursor-pointer hover:bg-gray-700" onclick="openCreateModal()">
    <!-- Profile Picture -->
    <img src="{{ user.profile.profile_picture.url }}" alt="Profile" class="w-10 h-10 rounded-full border border-gray-500">
    
    <!-- Input Placeholder -->
    <input class="w-full bg-gray-700 p-3 rounded-full text-white cursor-pointer placeholder-gray-400" placeholder="What's on your mind, {{ user.username }}?" readonly>
</div>



<script>
    function openCreateModal() {
        let modal = document.getElementById('postModal');
        
        // Reset modal for new post creation
        document.getElementById('postId').value = "";
        document.getElementById('postDescription').value = "";
        document.getElementById('modalTitle').innerText = "Create post";
        document.getElementById('submitButton').innerText = "Post";

        // Show the modal
        modal.classList.remove('hidden');
    }

    function openEditModal(postId, description) {
        let modal = document.getElementById('postModal');

        // Set data for editing
        document.getElementById('postId').value = postId;
        document.getElementById('postDescription').value = description;
        document.getElementById('modalTitle').innerText = "Edit post";
        document.getElementById('submitButton').innerText = "Update";

        // Show the modal
        modal.classList.remove('hidden');
    }

    function closeModal() {
        let modal = document.getElementById('postModal');
        modal.classList.add('hidden');
    }

    function submitPost(event) {
        event.preventDefault(); // Prevent default form submission

        let form = document.getElementById("postForm");
        let formData = new FormData(form);
        let csrfToken = document.querySelector("[name=csrfmiddlewaretoken]").value;

        fetch("/post/", {
            method: "POST",
            body: formData,
            headers: { "X-CSRFToken": csrfToken }
        })
        .then(response => response.json())
        .then(data => {
            // Update messages instantly
            let messageBox = document.getElementById("messageContainer");
            messageBox.innerHTML = data.messages;

            if (data.success) {
                closeModal();
                document.getElementById("postForm").reset(); // Reset form after success
            }
        })
        .catch(error => console.error("Error:", error));
    }

    document.getElementById("postForm").addEventListener("submit", submitPost);
</script>



